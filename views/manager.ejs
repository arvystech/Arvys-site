<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Manager | ARVYS</title>

    <!-- ======= Styles =======-->
    <link href="/assets/vendors/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link href="/assets/vendors/aos/aos.css" rel="stylesheet" />
    <link href="/assets/css/style.css" rel="stylesheet" />

    <style>
        :root {
            --sidebar-width: 280px;
            --primary-bg: #F8FAFC;
        }

        body {
            background-color: var(--primary-bg);
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .manager-sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: #fff;
            border-right: 1px solid #e2e8f0;
            z-index: 1000;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .manager-content {
            margin-left: var(--sidebar-width);
            padding: 40px;
            min-height: 100vh;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin-top: 40px;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #64748B;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #F1F5F9;
            color: var(--bs-primary);
        }

        .nav-link.active {
            background: #EEF2FF;
            color: var(--bs-primary);
        }

        /* Card Styles */
        .content-card {
            background: #fff;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #f1f5f9;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Course List Table */
        .course-table img {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            object-fit: cover;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-available { background: #DCFCE7; color: #15803D; }
        .status-coming { background: #FEF9C3; color: #854D0E; }
        .status-closed { background: #FEE2E2; color: #B91C1C; }

        .btn-action {
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }

        /* Form Styles */
        .dynamic-item {
            background: #F8FAFC;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid #E2E8F0;
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #ef4444;
            cursor: pointer;
        }

        @media (max-width: 991px) {
            .manager-sidebar {
                transform: translateX(-100%);
            }
            .manager-content {
                margin-left: 0;
            }
            .manager-sidebar.show {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="manager-sidebar">
        <div class="d-flex align-items-center gap-2 mb-4">
            <img src="/assets/public/IMAGES/logos/logo.svg" height="40" alt="Logo">
            <h5 class="mb-0 fw-bold">Manager</h5>
        </div>

        <ul class="nav-menu">
            <!-- Course Management -->
            <li class="nav-item">
                <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem; padding-left: 16px;">ðŸ“š Course Management</small>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link active" onclick="showTab('course-list')">
                    <i class="bi bi-grid"></i> All Courses
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="document.getElementById('editCourseId').value=''; showTab('course-add')">
                    <i class="bi bi-plus-circle"></i> Add New Course
                </a>
            </li>

            <!-- Staff Management -->
            <li class="nav-item mt-4">
                <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem; padding-left: 16px;">ðŸ‘¥ Staff Management</small>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showTab('staff-list')">
                    <i class="bi bi-people"></i> All Staff
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="document.getElementById('editStaffId').value=''; showTab('staff-add')">
                    <i class="bi bi-person-plus"></i> Add New Staff
                </a>
            </li>

            <!-- Quick Links -->
            <li class="nav-item">
                <a href="/" class="nav-link">
                    <i class="bi bi-house"></i> Home
                </a>
            </li>
            <li class="nav-item">
                <a href="/manager/logout" class="nav-link text-danger">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="manager-content">
        <!-- Top Bar -->
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h2 class="fw-bold mb-1" id="pageMainTitle">Manager</h2>
                <p class="text-muted" id="pageSubtitle">Welcome back! Manage your courses and staff.</p>
            </div>
            <div class="d-lg-none">
                <button class="btn btn-outline-primary" onclick="toggleSidebar()">
                    <i class="bi bi-list"></i>
                </button>
            </div>
        </div>

        <!-- Tab: Course List -->
        <div id="courseListTab">
            <div class="content-card" data-aos="fade-up">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-bold mb-0">Course Inventory</h5>
                    <button class="btn btn-primary rounded-pill px-4" onclick="showTab('course-add')">
                        <i class="bi bi-plus-lg me-2"></i>New Course
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle course-table">
                        <thead class="table-light">
                            <tr>
                                <th>Course</th>
                                <th>Level</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (courses && courses.length > 0) { %>
                                <% courses.forEach(course => { %>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <img src="<%= course.image_path || '/assets/images/business/business-img-2-min.jpg' %>" alt="">
                                                <div>
                                                    <div class="fw-bold"><%= course.title %></div>
                                                    <small class="text-muted"><%= course.duration %></small>
                                                </div>
                                            </div>
                                        </td>
                                        <td><span class="badge bg-light text-dark border"><%= course.level %></span></td>
                                        <td class="fw-bold">â‚¦<%= Number(course.price).toLocaleString() %></td>
                                        <td>
                                            <span class="status-badge status-<%= course.availability === 'coming soon' ? 'coming' : course.availability %>">
                                                <%= course.availability %>
                                            </span>
                                        </td>
                                        <td>
                                            <div class="d-flex gap-2">
                                                <a href="/course-details/<%= course.slug %>" class="btn-action bg-primary-subtle text-primary" title="View"><i class="bi bi-eye"></i></a>
                                                <button class="btn-action bg-warning-subtle text-warning" title="Edit" onclick="editCourse('<%= course.slug %>')"><i class="bi bi-pencil"></i></button>
                                                <button class="btn-action bg-danger-subtle text-danger" title="Delete" onclick="deleteCourse('<%= course.id %>')"><i class="bi bi-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="5" class="text-center py-5">
                                        <i class="bi bi-journal-x display-4 text-muted"></i>
                                        <p class="mt-2 text-muted">No courses found. Start by adding one!</p>
                                    </td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Add/Edit Course -->
        <div id="courseAddTab" style="display: none;">
            <form id="courseForm">
                <input type="hidden" name="courseId" id="editCourseId">
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Basic Info -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <h5 class="section-title"><i class="bi bi-info-circle"></i> Basic Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600">Course Title</label>
                                    <input type="text" class="form-control" name="title" required placeholder="e.g. Graphic Design Masterclass">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-600">Slug (URL)</label>
                                    <input type="text" class="form-control" name="slug" required placeholder="e.g. graphic-design">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-600">Tagline</label>
                                    <input type="text" class="form-control" name="tagline" required placeholder="Catchy one-liner">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-600">Description</label>
                                    <textarea class="form-control" name="description" rows="5" required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Learning Outcomes -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-bullseye me-2"></i>Learning Outcomes</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addOutcome()">+ Add Item</button>
                            </div>
                            <div id="outcomesContainer">
                                <div class="dynamic-item">
                                    <input type="text" class="form-control outcome-title" placeholder="Students will be able to..." required>
                                </div>
                            </div>
                        </div>

                        <!-- Curriculum -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-journal-text me-2"></i>Curriculum</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSection()">+ Add Section</button>
                            </div>
                            <div id="sectionsContainer">
                                <div class="dynamic-item section-block">
                                    <div class="row g-3">
                                        <div class="col-md-8">
                                            <input type="text" class="form-control section-title-input" placeholder="Section Title (e.g. Module 1: Intro)" required>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control section-duration" placeholder="Duration (e.g. 2 hrs)">
                                        </div>
                                        <div class="col-12">
                                            <div class="topic-list ps-3 border-start">
                                                <div class="topic-item mb-2">
                                                    <input type="text" class="form-control form-control-sm topic-title" placeholder="Topic title" required>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="addTopic(this)">+ Add Topic</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <!-- Sidebar Details -->
                        <div class="content-card sticky-top" style="top: 20px;">
                            <h5 class="fw-bold mb-4">Publish Details</h5>
                            
                            <div class="mb-3">
                                <label class="form-label fw-600">Price (â‚¦)</label>
                                <input type="number" class="form-control" name="price" required placeholder="0">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-600">Level</label>
                                <select class="form-select" name="level">
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-600">Duration</label>
                                <input type="text" class="form-control" name="duration" placeholder="e.g. 12 Weeks">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-600">Availability</label>
                                <select class="form-select" name="availability">
                                    <option value="available">Available</option>
                                    <option value="coming soon">Coming Soon</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-600">Course Image</label>
                                <input type="file" class="form-control" name="course_image" accept="image/*">
                                <div id="currentImageDisplay" class="mt-2" style="display: none;">
                                    <small class="text-muted">Current image exists</small>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 py-3 rounded-pill fw-bold shadow-lg mt-2">
                                <i class="bi bi-cloud-arrow-up me-2"></i>PUBLISH COURSE
                            </button>
                            <button type="button" class="btn btn-light w-100 py-3 rounded-pill mt-3" onclick="showTab('list')">
                                CANCEL
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Tab: Staff List -->
        <div id="staffListTab" style="display: none;">
            <div class="content-card" data-aos="fade-up">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-bold mb-0">Staff Directory</h5>
                    <button class="btn btn-primary rounded-pill px-4" onclick="showTab('staff-add')">
                        <i class="bi bi-person-plus me-2"></i>Add Staff
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Staff Member</th>
                                <th>Role</th>
                                <th>Badge</th>
                                <th>Stats</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (staff && staff.length > 0) { %>
                                <% staff.forEach(member => { %>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <img src="<%= member.profile_image || '/assets/images/default-avatar.jpg' %>" 
                                                     class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;" alt="">
                                                <div>
                                                    <div class="fw-bold"><%= member.first_name %> <%= member.last_name %></div>
                                                    <small class="text-muted"><%= member.email %></small>
                                                </div>
                                            </div>
                                        </td>
                                        <td><small class="text-muted"><%= member.title %></small></td>
                                        <td><span class="badge bg-info-subtle text-info border-info-subtle"><%= member.badge || 'None' %></span></td>
                                        <td>
                                            <div style="font-size: 0.8rem;">
                                                <i class="bi bi-people me-1"></i><%= member.students_count || 0 %> | 
                                                <i class="bi bi-star-fill text-warning me-1"></i><%= Number(member.average_rating || 0).toFixed(1) %>/5
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex gap-2">
                                                <a href="/staffs/<%= member.slug %>" class="btn-action bg-primary-subtle text-primary" title="View"><i class="bi bi-eye"></i></a>
                                                <button class="btn-action bg-warning-subtle text-warning" title="Edit" onclick="editStaff('<%= member.id %>')"><i class="bi bi-pencil"></i></button>
                                                <button class="btn-action bg-danger-subtle text-danger" title="Delete" onclick="deleteStaff('<%= member.id %>')"><i class="bi bi-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="5" class="text-center py-5">
                                        <i class="bi bi-people display-4 text-muted"></i>
                                        <p class="mt-2 text-muted">No staff found. Join the team!</p>
                                    </td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Add/Edit Staff -->
        <div id="staffAddTab" style="display: none;">
            <form id="staffForm">
                <input type="hidden" name="staffId" id="editStaffId">
                <div class="row">
                    <!-- Main Form Column -->
                    <div class="col-lg-8">
                        <!-- Personal Profile -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <h5 class="section-title"><i class="bi bi-person-badge"></i> Personal Profile</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600">First Name</label>
                                    <input type="text" class="form-control" name="first_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-600">Last Name</label>
                                    <input type="text" class="form-control" name="last_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-600">Email Address</label>
                                    <input type="email" class="form-control" name="email" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-600">Phone Number</label>
                                    <input type="text" class="form-control" name="phone">
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label fw-600">Professional Title</label>
                                    <input type="text" class="form-control" name="title" required placeholder="e.g. Senior Software Engineer">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-600">Role Badge</label>
                                    <input type="text" class="form-control" name="badge" placeholder="e.g. Lead Instructor">
                                </div>
                            </div>
                        </div>

                        <!-- Bio -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <h5 class="section-title"><i class="bi bi-person-lines-fill"></i> Biography</h5>
                            <div class="col-12">
                                <label class="form-label fw-600">Short Professional Bio</label>
                                <textarea class="form-control" name="bio" rows="6" placeholder="Tell us about the staff member's background and expertise..."></textarea>
                            </div>
                        </div>

                        <!-- Expertise/Skills -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-patch-check me-2"></i>Expertise & Skills</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addStaffSkill()">+ Add Skill</button>
                            </div>
                            <div id="staffSkillsContainer">
                                <div class="dynamic-item">
                                    <div class="row g-3">
                                        <div class="col-md-8">
                                            <input type="text" class="form-control skill-category" placeholder="Skill/Category" required>
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select skill-level">
                                                <option value="Beginner">Beginner</option>
                                                <option value="Intermediate">Intermediate</option>
                                                <option value="Advanced">Advanced</option>
                                                <option value="Expert">Expert</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Experience -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-briefcase me-2"></i>Professional Experience</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addStaffExperience()">+ Add Experience</button>
                            </div>
                            <div id="staffExperienceContainer">
                                <div class="dynamic-item exp-block">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control exp-job-title" placeholder="Job Title" required>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control exp-company" placeholder="Company Name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small">Start Date</label>
                                            <input type="date" class="form-control exp-start-date">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small">End Date</label>
                                            <input type="date" class="form-control exp-end-date">
                                        </div>
                                        <div class="col-12">
                                            <textarea class="form-control exp-description" rows="2" placeholder="Brief description..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Certifications -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-trophy me-2"></i>Certifications</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addStaffCert()">+ Add Certification</button>
                            </div>
                            <div id="staffCertsContainer">
                                <div class="dynamic-item cert-block">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control cert-name" placeholder="Certification Name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control cert-org" placeholder="Organization" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Links -->
                        <div class="content-card mb-4" data-aos="fade-up">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="bi bi-share me-2"></i>Social Media Links</h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addStaffSocial()">+ Add Social</button>
                            </div>
                            <div id="staffSocialContainer">
                                <div class="dynamic-item social-block">
                                    <div class="row g-3">
                                        <div class="col-md-5">
                                            <select class="form-select social-platform">
                                                <option value="linkedin">LinkedIn</option>
                                                <option value="twitter">Twitter / X</option>
                                                <option value="github">GitHub</option>
                                                <option value="facebook">Facebook</option>
                                                <option value="instagram">Instagram</option>
                                                <option value="dribbble">Dribbble</option>
                                                <option value="behance">Behance</option>
                                                <option value="youtube">YouTube</option>
                                                <option value="tiktok">TikTok</option>
                                                <option value="whatsapp">WhatsApp</option>
                                                <option value="medium">Medium</option>
                                            </select>
                                        </div>
                                        <div class="col-md-7">
                                            <input type="url" class="form-control social-url" placeholder="Profile URL" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar Stats Column -->
                    <div class="col-lg-4">
                        <div class="content-card sticky-top" style="top: 20px;">
                            <h5 class="fw-bold mb-4">Staff Details</h5>
                            <div class="mb-3">
                                <label class="form-label fw-600">Custom Slug</label>
                                <input type="text" class="form-control" name="slug" required placeholder="e.g. john-doe">
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-600">Profile Image</label>
                                <input type="file" class="form-control" name="profile_image_file" accept="image/*" onchange="previewImage(this, 'staffPreview')">
                                <input type="hidden" name="profile_image" id="staffCurrentImg">
                                <div id="staffPreview" class="mt-3 text-center" style="display: none;">
                                    <img src="" class="img-thumbnail" style="max-height: 150px;">
                                    <p class="small text-muted mt-1">Current/New Preview</p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-600">Personal Website</label>
                                <input type="url" class="form-control" name="personal_website" placeholder="https://yourportfolio.com">
                            </div>

                            <hr class="my-4">
                            <h6 class="fw-bold mb-3">Statistics</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-6">
                                    <label class="form-label small fw-600">Students</label>
                                    <input type="number" class="form-control" name="students_count" value="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-600">Rating</label>
                                    <input type="number" step="0.1" class="form-control" name="average_rating" value="0.0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-600">Courses</label>
                                    <input type="number" class="form-control" name="courses_count" value="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-600">Years Exp.</label>
                                    <input type="number" class="form-control" name="years_experience" value="0">
                                </div>
                            </div>

                            <div class="form-check form-switch mb-4">
                                <input class="form-check-input" type="checkbox" name="is_active" checked>
                                <label class="form-check-label fw-600">Active Member</label>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 py-3 rounded-pill fw-bold shadow">
                                SAVE STAFF MEMBER
                            </button>
                            <button type="button" class="btn btn-light w-100 py-3 rounded-pill mt-3" onclick="showTab('staff-list')">
                                CANCEL
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- ======= Scripts =======-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendors/aos/aos.js"></script>

    <script>
        AOS.init({ duration: 800, once: true });

        function toggleSidebar() {
            document.querySelector('.manager-sidebar').classList.toggle('show');
        }

        function showTab(tab) {
            // Tab Containers
            const tabs = {
                'course-list': document.getElementById('courseListTab'),
                'course-add': document.getElementById('courseAddTab'),
                'staff-list': document.getElementById('staffListTab'),
                'staff-add': document.getElementById('staffAddTab')
            };

            // Sidebar Links Mapping
            const links = document.querySelectorAll('.nav-link');
            const linkMap = {
                'course-list': links[0],
                'course-add': links[1],
                'staff-list': links[2],
                'staff-add': links[3]
            };

            const pageTitle = document.getElementById('pageMainTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');

            // Hide all tabs
            Object.values(tabs).forEach(t => t.style.display = 'none');
            // Remove all active classes
            Object.values(linkMap).forEach(l => l?.classList.remove('active'));

            // Show selected tab
            if (tabs[tab]) {
                tabs[tab].style.display = 'block';
                if (linkMap[tab]) linkMap[tab].classList.add('active');
            }

            // Update titles and resets
            if (tab === 'course-list') {
                pageTitle.innerText = "Course Manager";
                pageSubtitle.innerText = "Manage your active and upcoming courses";
            } else if (tab === 'course-add') {
                const editId = document.getElementById('editCourseId').value;
                if (!editId || editId === "") {
                    // It's a fresh "Add New" request
                    document.getElementById('courseForm').reset();
                    document.getElementById('editCourseId').value = ""; // Safety clear
                    document.getElementById('outcomesContainer').innerHTML = '<div class="dynamic-item"><input type="text" class="form-control outcome-title" placeholder="Students will be able to..." required></div>';
                    document.getElementById('sectionsContainer').innerHTML = `<div class="dynamic-item section-block"><div class="row g-3"><div class="col-md-8"><input type="text" class="form-control section-title-input" required></div><div class="col-md-4"><input type="text" class="form-control section-duration"></div><div class="col-12"><div class="topic-list ps-3 border-start"><div class="topic-item mb-2"><input type="text" class="form-control form-control-sm topic-title" required></div></div><button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="addTopic(this)">+ Add Topic</button></div></div></div>`;
                    pageTitle.innerText = "Add New Course";
                } else {
                    pageTitle.innerText = "Edit Course";
                }
            } else if (tab === 'staff-list') {
                pageTitle.innerText = "Staff Directory";
                pageSubtitle.innerText = "Manage your team members and instructors";
            } else if (tab === 'staff-add') {
                const editId = document.getElementById('editStaffId').value;
                if (!editId || editId === "") {
                    // It's a fresh "Add New" request
                    document.getElementById('staffForm').reset();
                    document.getElementById('editStaffId').value = ""; // Safety clear
                    document.getElementById('staffCurrentImg').value = "";
                    document.getElementById('staffPreview').style.display = 'none';
                    // Reset Dynamic Staff Containers
                    document.getElementById('staffSkillsContainer').innerHTML = '<div class="dynamic-item"><div class="row g-3"><div class="col-md-8"><input type="text" class="form-control skill-category" placeholder="Skill/Category" required></div><div class="col-md-4"><select class="form-select skill-level"><option value="Beginner">Beginner</option><option value="Intermediate">Intermediate</option><option value="Advanced">Advanced</option><option value="Expert">Expert</option></select></div></div></div>';
                    document.getElementById('staffExperienceContainer').innerHTML = '<div class="dynamic-item exp-block"><div class="row g-3"><div class="col-md-6"><input type="text" class="form-control exp-job-title" placeholder="Job Title" required></div><div class="col-md-6"><input type="text" class="form-control exp-company" placeholder="Company Name" required></div><div class="col-md-6"><label class="form-label small">Start Date</label><input type="date" class="form-control exp-start-date"></div><div class="col-md-6"><label class="form-label small">End Date</label><input type="date" class="form-control exp-end-date"></div><div class="col-12"><textarea class="form-control exp-description" rows="2" placeholder="Brief description..."></textarea></div></div></div>';
                    document.getElementById('staffCertsContainer').innerHTML = '<div class="dynamic-item cert-block"><div class="row g-3"><div class="col-md-6"><input type="text" class="form-control cert-name" placeholder="Certification Name" required></div><div class="col-md-6"><input type="text" class="form-control cert-org" placeholder="Organization" required></div></div></div>';
                    document.getElementById('staffSocialContainer').innerHTML = '<div class="dynamic-item social-block"><div class="row g-3"><div class="col-md-5"><select class="form-select social-platform"><option value="linkedin">LinkedIn</option><option value="twitter">Twitter / X</option><option value="github">GitHub</option><option value="facebook">Facebook</option><option value="instagram">Instagram</option><option value="dribbble">Dribbble</option><option value="behance">Behance</option><option value="youtube">YouTube</option><option value="tiktok">TikTok</option><option value="whatsapp">WhatsApp</option><option value="medium">Medium</option></select></div><div class="col-md-7"><input type="url" class="form-control social-url" placeholder="URL" required></div></div></div>';
                    pageTitle.innerText = "Add New Staff Member";
                } else {
                    pageTitle.innerText = "Edit Staff";
                }
            }

            if(window.innerWidth < 992) toggleSidebar();
        }

        // Global Preview Function
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const img = preview.querySelector('img');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Dynamic Functions
        function addOutcome() {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i><input type="text" class="form-control outcome-title" required>`;
            document.getElementById('outcomesContainer').appendChild(div);
        }

        function addSection() {
            const div = document.createElement('div');
            div.className = 'dynamic-item section-block';
            div.innerHTML = `
                <i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                <div class="row g-3">
                    <div class="col-md-8"><input type="text" class="form-control section-title-input" required></div>
                    <div class="col-md-4"><input type="text" class="form-control section-duration"></div>
                    <div class="col-12">
                        <div class="topic-list ps-3 border-start">
                            <div class="topic-item mb-2"><input type="text" class="form-control form-control-sm topic-title" required></div>
                        </div>
                        <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="addTopic(this)">+ Add Topic</button>
                    </div>
                </div>`;
            document.getElementById('sectionsContainer').appendChild(div);
        }

        function addTopic(btn) {
            const list = btn.previousElementSibling;
            const div = document.createElement('div');
            div.className = 'topic-item mb-2 d-flex gap-2';
            div.innerHTML = `<input type="text" class="form-control form-control-sm topic-title" required><i class="bi bi-dash-circle text-danger cursor-pointer" onclick="this.parentElement.remove()"></i>`;
            list.appendChild(div);
        }

        // Staff Dynamic Functions
        function addStaffSkill() {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                <div class="row g-3">
                    <div class="col-md-8"><input type="text" class="form-control skill-category" placeholder="Skill/Category" required></div>
                    <div class="col-md-4"><select class="form-select skill-level"><option value="Beginner">Beginner</option><option value="Intermediate">Intermediate</option><option value="Advanced">Advanced</option><option value="Expert">Expert</option></select></div>
                </div>`;
            document.getElementById('staffSkillsContainer').appendChild(div);
        }

        function addStaffExperience() {
            const div = document.createElement('div');
            div.className = 'dynamic-item exp-block';
            div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                <div class="row g-3">
                    <div class="col-md-6"><input type="text" class="form-control exp-job-title" placeholder="Job Title" required></div>
                    <div class="col-md-6"><input type="text" class="form-control exp-company" placeholder="Company Name" required></div>
                    <div class="col-md-6"><label class="form-label small">Start Date</label><input type="date" class="form-control exp-start-date"></div>
                    <div class="col-md-6"><label class="form-label small">End Date</label><input type="date" class="form-control exp-end-date"></div>
                    <div class="col-12"><textarea class="form-control exp-description" rows="2" placeholder="Brief description..."></textarea></div>
                </div>`;
            document.getElementById('staffExperienceContainer').appendChild(div);
        }

        function addStaffCert() {
            const div = document.createElement('div');
            div.className = 'dynamic-item cert-block';
            div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                <div class="row g-3">
                    <div class="col-md-6"><input type="text" class="form-control cert-name" placeholder="Certification Name" required></div>
                    <div class="col-md-6"><input type="text" class="form-control cert-org" placeholder="Organization" required></div>
                </div>`;
            document.getElementById('staffCertsContainer').appendChild(div);
        }

        function addStaffSocial() {
            const container = document.getElementById('staffSocialContainer');
            if (container.querySelectorAll('.social-block').length >= 3) {
                alert("Maximum 3 social links allowed.");
                return;
            }
            const div = document.createElement('div');
            div.className = 'dynamic-item social-block';
            div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                <div class="row g-3">
                    <div class="col-md-5">
                        <select class="form-select social-platform">
                            <option value="linkedin">LinkedIn</option>
                            <option value="twitter">Twitter / X</option>
                            <option value="github">GitHub</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="dribbble">Dribbble</option>
                            <option value="behance">Behance</option>
                            <option value="youtube">YouTube</option>
                            <option value="tiktok">TikTok</option>
                            <option value="whatsapp">WhatsApp</option>
                            <option value="medium">Medium</option>
                        </select>
                    </div>
                    <div class="col-md-7"><input type="url" class="form-control social-url" placeholder="URL" required></div>
                </div>`;
            container.appendChild(div);
        }

        // Course Edit Functionality
        async function editCourse(slug) {
            try {
                const response = await fetch(`/api/courses/${slug}`);
                const course = await response.json();
                
                if (response.ok) {
                    const form = document.getElementById('courseForm');
                    document.getElementById('editCourseId').value = course.id;
                    form.title.value = course.title;
                    form.slug.value = course.slug;
                    form.tagline.value = course.tagline;
                    form.description.value = course.description;
                    form.price.value = course.price;
                    form.level.value = course.level;
                    form.duration.value = course.duration;
                    form.availability.value = course.availability;

                    // Outcomes
                    const outCont = document.getElementById('outcomesContainer');
                    outCont.innerHTML = "";
                    course.outcomes.forEach(out => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item';
                        div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i><input type="text" class="form-control outcome-title" value="${out.title}" required>`;
                        outCont.appendChild(div);
                    });

                    // Curriculum
                    const secCont = document.getElementById('sectionsContainer');
                    secCont.innerHTML = "";
                    course.curriculum.forEach(sec => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item section-block';
                        let topicsHtml = "";
                        sec.topics.forEach(top => {
                            topicsHtml += `<div class="topic-item mb-2 d-flex gap-2"><input type="text" class="form-control form-control-sm topic-title" value="${top.title}" required><i class="bi bi-dash-circle text-danger cursor-pointer" onclick="this.parentElement.remove()"></i></div>`;
                        });
                        div.innerHTML = `
                            <i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                            <div class="row g-3">
                                <div class="col-md-8"><input type="text" class="form-control section-title-input" value="${sec.title}" required></div>
                                <div class="col-md-4"><input type="text" class="form-control section-duration" value="${sec.duration}"></div>
                                <div class="col-12">
                                    <div class="topic-list ps-3 border-start">${topicsHtml}</div>
                                    <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" onclick="addTopic(this)">+ Add Topic</button>
                                </div>
                            </div>`;
                        secCont.appendChild(div);
                    });

                    showTab('course-add');
                }
            } catch (err) {
                console.error(err);
                alert("Error loading course details");
            }
        }

        async function deleteCourse(id) {
            if (confirm("Are you sure you want to delete this course? This action cannot be undone.")) {
                try {
                    const response = await fetch(`/api/courses/${id}`, { method: 'DELETE' });
                    if (response.ok) {
                        location.reload();
                    } else {
                        const res = await response.json();
                        alert(res.message);
                    }
                } catch (err) {
                    alert("Failed to delete course");
                }
            }
        }

        // Staff Management Functions
        async function editStaff(id) {
            try {
                const response = await fetch(`/api/staff/${id}`);
                const staff = await response.json();
                
                if (response.ok) {
                    const form = document.getElementById('staffForm');
                    document.getElementById('editStaffId').value = staff.id;
                    form.first_name.value = staff.first_name;
                    form.last_name.value = staff.last_name;
                    form.email.value = staff.email;
                    form.phone.value = staff.phone || '';
                    form.title.value = staff.title;
                    form.badge.value = staff.badge || '';
                    form.bio.value = staff.bio || '';
                    form.slug.value = staff.slug;
                    document.getElementById('staffCurrentImg').value = staff.profile_image || '';
                    
                    // Update preview
                    const preview = document.getElementById('staffPreview');
                    if (staff.profile_image) {
                        preview.style.display = 'block';
                        preview.querySelector('img').src = staff.profile_image;
                    } else {
                        preview.style.display = 'none';
                    }

                    form.years_experience.value = staff.years_experience || 0;
                    form.personal_website.value = staff.personal_website || '';
                    form.is_active.checked = staff.is_active;
                    form.students_count.value = staff.students_count || 0;
                    form.average_rating.value = staff.average_rating || 0.0;
                    form.courses_count.value = staff.courses_count || 0;
                    form.years_experience.value = staff.years_experience || 0;

                    // Skills
                    const skillCont = document.getElementById('staffSkillsContainer');
                    skillCont.innerHTML = "";
                    staff.expertise.forEach(skill => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item';
                        div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                            <div class="row g-3">
                                <div class="col-md-8"><input type="text" class="form-control skill-category" value="${skill.category}" required></div>
                                <div class="col-md-4"><select class="form-select skill-level"><option value="Beginner" ${skill.proficiency_level === 'Beginner' ? 'selected' : ''}>Beginner</option><option value="Intermediate" ${skill.proficiency_level === 'Intermediate' ? 'selected' : ''}>Intermediate</option><option value="Advanced" ${skill.proficiency_level === 'Advanced' ? 'selected' : ''}>Advanced</option><option value="Expert" ${skill.proficiency_level === 'Expert' ? 'selected' : ''}>Expert</option></select></div>
                            </div>`;
                        skillCont.appendChild(div);
                    });

                    // Experience
                    const expCont = document.getElementById('staffExperienceContainer');
                    expCont.innerHTML = "";
                    staff.experience.forEach(exp => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item exp-block';
                        div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                            <div class="row g-3">
                                <div class="col-md-6"><input type="text" class="form-control exp-job-title" value="${exp.job_title}" required></div>
                                <div class="col-md-6"><input type="text" class="form-control exp-company" value="${exp.company_name}" required></div>
                                <div class="col-md-6"><label class="form-label small">Start Date</label><input type="date" class="form-control exp-start-date" value="${exp.start_date ? exp.start_date.split('T')[0] : ''}"></div>
                                <div class="col-md-6"><label class="form-label small">End Date</label><input type="date" class="form-control exp-end-date" value="${exp.end_date ? exp.end_date.split('T')[0] : ''}"></div>
                                <div class="col-12"><textarea class="form-control exp-description" rows="2">${exp.description || ''}</textarea></div>
                            </div>`;
                        expCont.appendChild(div);
                    });

                    // Certs
                    const certCont = document.getElementById('staffCertsContainer');
                    certCont.innerHTML = "";
                    staff.certifications.forEach(cert => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item cert-block';
                        div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                            <div class="row g-3">
                                <div class="col-md-6"><input type="text" class="form-control cert-name" value="${cert.certification_name}" required></div>
                                <div class="col-md-6"><input type="text" class="form-control cert-org" value="${cert.issuing_organization}" required></div>
                            </div>`;
                        certCont.appendChild(div);
                    });

                    // Social
                    const socialCont = document.getElementById('staffSocialContainer');
                    socialCont.innerHTML = "";
                    staff.social_links.slice(0, 3).forEach(link => {
                        const div = document.createElement('div');
                        div.className = 'dynamic-item social-block';
                        div.innerHTML = `<i class="bi bi-x-circle remove-btn" onclick="this.parentElement.remove()"></i>
                            <div class="row g-3">
                                <div class="col-md-5">
                                    <select class="form-select social-platform">
                                        <option value="linkedin" ${link.platform === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                                        <option value="twitter" ${link.platform === 'twitter' ? 'selected' : ''}>Twitter / X</option>
                                        <option value="github" ${link.platform === 'github' ? 'selected' : ''}>GitHub</option>
                                        <option value="facebook" ${link.platform === 'facebook' ? 'selected' : ''}>Facebook</option>
                                        <option value="instagram" ${link.platform === 'instagram' ? 'selected' : ''}>Instagram</option>
                                        <option value="dribbble" ${link.platform === 'dribbble' ? 'selected' : ''}>Dribbble</option>
                                        <option value="behance" ${link.platform === 'behance' ? 'selected' : ''}>Behance</option>
                                        <option value="youtube" ${link.platform === 'youtube' ? 'selected' : ''}>YouTube</option>
                                        <option value="tiktok" ${link.platform === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                        <option value="whatsapp" ${link.platform === 'whatsapp' ? 'selected' : ''}>WhatsApp</option>
                                        <option value="medium" ${link.platform === 'medium' ? 'selected' : ''}>Medium</option>
                                    </select>
                                </div>
                                <div class="col-md-7"><input type="url" class="form-control social-url" value="${link.profile_url}" required></div>
                            </div>`;
                        socialCont.appendChild(div);
                    });

                    showTab('staff-add');
                }
            } catch (err) {
                console.error(err);
                alert("Error loading staff details");
            }
        }

        async function deleteStaff(id) {
            if (confirm("Are you sure you want to delete this staff member? This will remove all their data permanently.")) {
                try {
                    const response = await fetch(`/api/staff/${id}`, { method: 'DELETE' });
                    if (response.ok) {
                        location.reload();
                    } else {
                        const res = await response.json();
                        alert(res.message);
                    }
                } catch (err) {
                    alert("Failed to delete staff member");
                }
            }
        }

        // Form Submit Handlers
        document.getElementById('courseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const courseId = document.getElementById('editCourseId').value;
            
            // Outcomes JSON
            const outcomes = [];
            document.querySelectorAll('.outcome-title').forEach((inp, i) => {
                outcomes.push({ title: inp.value, outcome_order: i + 1 });
            });
            formData.append('outcomes', JSON.stringify(outcomes));

            // Sections JSON
            const sections = [];
            document.querySelectorAll('.section-block').forEach((secEl, si) => {
                const section = {
                    title: secEl.querySelector('.section-title-input').value,
                    duration: secEl.querySelector('.section-duration').value,
                    section_order: si + 1,
                    topics: []
                };
                secEl.querySelectorAll('.topic-title').forEach((topInp, ti) => {
                    section.topics.push({ title: topInp.value, topic_order: ti + 1 });
                });
                sections.push(section);
            });
            formData.append('sections', JSON.stringify(sections));

            const url = courseId ? `/api/courses/${courseId}` : '/api/courses';
            const method = courseId ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, { method: method, body: formData });
                if (response.ok) {
                    alert(courseId ? "Course updated!" : "Course published!");
                    location.reload();
                } else {
                    const res = await response.json();
                    alert(res.message);
                }
            } catch (err) {
                alert("Processing failed");
            }
        });

        document.getElementById('staffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const staffId = document.getElementById('editStaffId').value;
            
            // Serialize Skills
            const skills = [];
            document.querySelectorAll('#staffSkillsContainer .dynamic-item').forEach((el, i) => {
                skills.push({
                    category: el.querySelector('.skill-category').value,
                    level: el.querySelector('.skill-level').value,
                    display_order: i + 1
                });
            });
            formData.append('expertise', JSON.stringify(skills));

            // Serialize Experience
            const experience = [];
            document.querySelectorAll('#staffExperienceContainer .exp-block').forEach(el => {
                experience.push({
                    job_title: el.querySelector('.exp-job-title').value,
                    company_name: el.querySelector('.exp-company').value,
                    start_date: el.querySelector('.exp-start-date').value,
                    end_date: el.querySelector('.exp-end-date').value,
                    description: el.querySelector('.exp-description').value
                });
            });
            formData.append('experience', JSON.stringify(experience));

            // Serialize Certs
            const certs = [];
            document.querySelectorAll('#staffCertsContainer .cert-block').forEach(el => {
                certs.push({
                    name: el.querySelector('.cert-name').value,
                    org: el.querySelector('.cert-org').value
                });
            });
            formData.append('certifications', JSON.stringify(certs));

            // Serialize Social
            const social = [];
            document.querySelectorAll('#staffSocialContainer .social-block').forEach(el => {
                social.push({
                    platform: el.querySelector('.social-platform').value,
                    url: el.querySelector('.social-url').value
                });
            });
            formData.append('social_links', JSON.stringify(social));

            const url = staffId ? `/api/staff/${staffId}` : '/api/staff';
            const method = staffId ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, { method: method, body: formData });
                if (response.ok) {
                    alert(staffId ? "Staff member updated!" : "Staff member added!");
                    location.reload();
                } else {
                    const res = await response.json();
                    alert(res.message);
                }
            } catch (err) {
                console.error(err);
                alert("Processing failed");
            }
        });

        // Loader
        window.addEventListener("load", () => {
            const loader = document.getElementById("pageLoader");
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
            }
        });
    </script>
</body>

</html>
